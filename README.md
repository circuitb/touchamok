touchamok
=========

Mapamok to Touch077 interface

<p>A modified binary of Kyle McDonald&#8217;s opensource Mapamok <a href="https://github.com/YCAMInterlab/ProCamToolkit/wiki/mapamok-(English)" title="code" target="_blank">code</a> to quickly calibrate a virtual 3d model to a projector and TouchDesigner 077 .toe files for rendering. 

Here are some notes on the process:</p>
<p><span id="more-73"></span></p>
<p>1. construct a virtual model of the object you want to map. This is probably the most time consuming process but since the calculated projection matrix will attempt to stretch, scale and shear your model into the projector&#8217;s viewpoint you do get a little tolerance in regards to your model not exactly matching real world measurements.</p>
<p><a href="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/1.jpg"><img src="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/1-300x266.jpg" alt="virtual model" title="virtual model" width="300" height="266" class="alignnone size-medium wp-image-74" /></a></p>
<p>virtual model made by modeling one face of the object using photographs and then duplicating</p>
<p>2. Open up modified Mapamok program with your virtual model converted to fbx format. Select a feature point on the virtual model</p>
<p><a href="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/2.jpg"><img src="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/2.jpg" alt="" title="model in mapamok" width="555" height="350" class="alignnone size-full wp-image-75" /></a></p>
<p>3. Press space bar to switch to projector view. It is assumed that you are duplicating the same display on your monitor and on your projector. Move the cursor to the same feature on the real model from the projector&#8217;s view</p>
<p><a href="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/3.jpg"><img src="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/3.jpg" alt="" title="adding correspondence" width="533" height="300" class="alignnone size-full wp-image-78" /></a></p>
<p>4. Repeat this process for at least 5 points. After five points the program will attempt to calculate the best fitting transformation and projection for your virtual model and render it to the screen.</p>
<p><a href="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/4.jpg"><img src="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/4.jpg" alt="" title="one projector calibrated" width="533" height="300" class="alignnone size-full wp-image-79" /></a></p>
<p>5. Add more points as needed to refine the fit. Since the program only figures out a rotation, translation and perspective skew, adding more points will only improve the fit to a certain extent. Going back and moving around the points can also help improve the match.</p>
<p>6. Once you have a good fit select save Calibration. An xml file will be generated with openCV&#8217;s best guess for the transformation and projection matrix values to match your virtual model to the projected view.</p>
<p>7. If you have more than one projector you must repeat this process for each projector. Save a copy of the first projector&#8217;s xml output and then switch the first projector&#8217;s display cable with the second one and reopen mapamok.</p>
<p><a href="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/5.jpg"><img src="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/5.jpg" alt="" title="two projectors calibrated on one model" width="533" height="300" class="alignnone size-full wp-image-76" /></a></p>
<p>8. Open the touchdesigner template and import the same fbx model that you used in mapamok. press the button to load the xml file data into touch. This will apply the transformation matrix to your imported geometry. It will also apply the projection matrix to your touch designer camera. Now your Touch Designer render should match the output generated by Mapamok.</p>
<p><a href="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/6.jpg"><img src="http://jameshurlbut.net/wp/wp-content/uploads/2013/01/6.jpg" alt="" title="touchdesigner view" width="793" height="500" class="alignnone size-full wp-image-77" /></a></p>
<p>9. Now that you&#8217;ve saved out the configuration files for the two projectors you can switch your desktop to extended view and load up a comp for each projector swapping out the xml files with the one generated for that projector.</p>
<p>10. Now you can apply your touch designer TOPS, CHOPS and MATS as you would in any project.</p>
<p>Here is a video of a test using two projectors. Matching the features to get the xml output should take no longer than 10 to 20 minutes.</p>

<span class="vvqbox vvqvimeo" style="width:560px;height:400px;"><iframe id="vvq-73-vimeo-1" src="http://player.vimeo.com/video/51327074?title=1&amp;byline=1&amp;portrait=0&amp;fullscreen=1" width="560" height="400" frameborder="0"><a href="http://www.vimeo.com/51327074">http://www.vimeo.com/51327074</a></iframe></span>
